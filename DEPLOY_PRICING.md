# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 18
- SQLite3
- –î–æ—Å—Ç—É–ø –∫ –ÆKassa –∞–∫–∫–∞—É–Ω—Ç—É

## üöÄ –®–∞–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
```bash
cd /path/to/psycholog
git pull origin main
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ÆKassa:
```javascript
// src/services/payment.ts
shopId: '1183996'
secretKey: 'live_OTmJmdMHX6ysyUcUpBz5kt-dmSq1pT-Y5gLgmpT1jXg'
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
# –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
sqlite3 zen-mind-mate.db "ALTER TABLE subscriptions ADD COLUMN meditation_access INTEGER DEFAULT 0;"
sqlite3 zen-mind-mate.db "ALTER TABLE subscriptions ADD COLUMN free_sessions_remaining INTEGER DEFAULT 0;"
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å
pkill -f "node app.js"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
cd server
node app.js
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

#### –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
```bash
curl -X POST http://localhost:3002/api/users/test_user/create-free-trial \
  -H "Content-Type: application/json"
```

#### –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
```bash
curl http://localhost:3002/api/users/test_user/audio-access
# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: {"hasAccess":true,"type":"free_trial","remaining":3}
```

#### –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
```bash
curl -X POST http://localhost:3002/api/payments/create \
  -H "Content-Type: application/json" \
  -d '{
    "amount": {"value": "250.00", "currency": "RUB"},
    "currency": "RUB",
    "description": "1 –∞—É–¥–∏–æ —Å–µ—Å—Å–∏—è —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º –ú–∞—Ä–∫–æ–º",
    "userId": "test_user",
    "metadata": {"userId": "test_user", "plan": "single_session"}
  }'
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫** –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 4 —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–∞
2. **–î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Å—Å–∏—è—Ö
3. **–ö–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã** –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–µ** –¥–æ–ª–∂–Ω–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
PRAGMA table_info(subscriptions);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
SELECT * FROM subscriptions WHERE plan = 'free_trial';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
SELECT * FROM subscriptions WHERE plan IN ('single_session', 'four_sessions', 'meditation_monthly');
```

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
```bash
tail -f server/server.log
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
# "Free trial subscription created for new user: ..."
# "Payment created in Yookassa: ..."
# "Subscription created: ..."
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
1. **HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –¥–ª—è –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
2. **–í–µ–±—Ö—É–∫–∏** –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–ª–∞—Ç–µ–∂–µ–π** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω
4. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ë–î** –¥–µ–ª–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
1. **Secret key** –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ
2. **Payment IDs** –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π –ø–æ–¥–ø–∏—Å–æ–∫
3. **Rate limiting** –¥–ª—è API endpoints –ø–ª–∞—Ç–µ–∂–µ–π

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
1. **–£—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏** –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
2. **–ù–µ—É–¥–∞—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏** –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
3. **–ö–æ–Ω–≤–µ—Ä—Å–∏—é** –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å
4. **–û—Ç—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ÆKassa –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å shopId –∏ secretKey

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞: –î–æ—Å—Ç—É–ø –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoints `/audio-access` –∏ `/meditation-access`

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `tail -f server/server.log`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: `sqlite3 zen-mind-mate.db`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API: `curl` –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥: –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

---

**–í–µ—Ä—Å–∏—è**: 1.3.0
**–î–∞—Ç–∞**: 18 –Ω–æ—è–±—Ä—è 2024
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: Node.js >= 18, –ÆKassa –∞–∫–∫–∞—É–Ω—Ç
