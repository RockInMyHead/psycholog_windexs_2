<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест Text-to-Speech</title>
</head>
<body>
    <h1>Тест TTS (локальный API)</h1>
    <input type="text" id="textInput" value="Привет, это тест синтеза речи" style="width: 300px;">
    <button id="speakBtn">Озвучить</button>
    <button id="testApiBtn">Тест API</button>
    <div id="status">Статус: готов</div>
    <div id="results"></div>

    <script>
        const textInput = document.getElementById('textInput');
        const speakBtn = document.getElementById('speakBtn');
        const testApiBtn = document.getElementById('testApiBtn');
        const status = document.getElementById('status');
        const results = document.getElementById('results');

        function log(message) {
            console.log(message);
            results.innerHTML += '<div>' + message + '</div>';
        }

        function updateStatus(message) {
            status.textContent = 'Статус: ' + message;
            log('Статус: ' + message);
        }

        testApiBtn.addEventListener('click', async () => {
            try {
                updateStatus('Тестируем API...');

                const response = await fetch('https://psycholog.windexs.ru/api/audio/speech', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'tts-1',
                        voice: 'onyx',
                        input: textInput.value,
                        response_format: 'mp3',
                        speed: 0.95
                    })
                });

                if (!response.ok) {
                    throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                }

                const audioBlob = await response.blob();
                log('API ответ получен, размер: ' + audioBlob.size + ' байт');

                updateStatus('Создаем аудио элемент...');
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);

                audio.onloadeddata = () => {
                    log('Аудио загружено, длительность: ' + audio.duration + ' сек');
                    updateStatus('Воспроизводим...');
                    audio.play();
                };

                audio.onended = () => {
                    updateStatus('Воспроизведение завершено');
                    URL.revokeObjectURL(audioUrl);
                };

                audio.onerror = (e) => {
                    log('Ошибка воспроизведения: ' + e);
                    updateStatus('Ошибка воспроизведения');
                };

            } catch (error) {
                log('Ошибка API: ' + error.message);
                updateStatus('Ошибка API');
            }
        });

        speakBtn.addEventListener('click', async () => {
            try {
                updateStatus('Проверяем Web Speech API...');

                if (!('speechSynthesis' in window)) {
                    throw new Error('Web Speech Synthesis не поддерживается');
                }

                updateStatus('Создаем utterance...');
                const utterance = new SpeechSynthesisUtterance(textInput.value);
                utterance.lang = 'ru-RU';
                utterance.rate = 0.9;
                utterance.pitch = 1;

                utterance.onstart = () => updateStatus('Говорим...');
                utterance.onend = () => updateStatus('Говорение завершено');
                utterance.onerror = (e) => {
                    log('Ошибка синтеза: ' + e.error);
                    updateStatus('Ошибка синтеза');
                };

                window.speechSynthesis.speak(utterance);

            } catch (error) {
                log('Ошибка: ' + error.message);
                updateStatus('Ошибка');
            }
        });
    </script>
</body>
</html>


