# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 502 Bad Gateway –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ 502 Bad Gateway —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç", –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ email.

## –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã

1. **Backend —Å–µ—Ä–≤–µ—Ä –Ω–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω**: Vite dev server –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–ª –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `http://localhost:1033`, –Ω–æ backend —Å–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–ª.

2. **–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: –í `database.js` –±—ã–ª–∞ –æ—à–∏–±–∫–∞ `Cannot access 'accessService' before initialization` –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞.

3. **–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫**: –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—ã—Ç–∞–ª–∏—Å—å –¥–æ–±–∞–≤–∏—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `meditation_access` –∏ `free_sessions_remaining`.

4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤ Express**: –ú–∞—Ä—à—Ä—É—Ç `/api/users/:userId` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–ª –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/users/by-email`.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ database.js

**–ë—ã–ª–æ:**
```javascript
// accessService –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞
module.exports = {
  // ...
  accessService, // –û—à–∏–±–∫–∞: accessService –µ—â–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
};

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ accessService –ø–æ—Å–ª–µ module.exports
const accessService = { /* ... */ };
```

**–°—Ç–∞–ª–æ:**
```javascript
// accessService –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ module.exports
const accessService = { /* ... */ };

module.exports = {
  // ...
  accessService,
};
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ó–∞–º–µ–Ω–∏–ª–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ `ALTER TABLE` –Ω–∞ try-catch –±–ª–æ–∫–∏:

```javascript
// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É subscriptions, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
try {
  sqlite.exec('ALTER TABLE subscriptions ADD COLUMN meditation_access INTEGER DEFAULT 0;');
} catch (error) {
  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if (!error.message.includes('duplicate column name')) {
    throw error;
  }
}
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ Express

–ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç `/api/users/by-email` –≤—ã—à–µ –º–∞—Ä—à—Ä—É—Ç–∞ `/api/users/:userId`:

```javascript
// –°–Ω–∞—á–∞–ª–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
app.get('/api/users/by-email', async (req, res) => { /* ... */ });

// –ü–æ—Ç–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
app.get('/api/users/:userId', async (req, res) => { /* ... */ });
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- Backend —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 1033
- API `/api/users/by-email` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- Vite –ø—Ä–æ–∫—Å–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ backend

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
curl "http://localhost:1033/api/users/by-email?email=test@example.com"

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST "http://localhost:1033/api/users" \
  -H "Content-Type: application/json" \
  -d '{"email":"new@example.com","name":"New User"}'
```

## –ö–æ–º–º–∏—Ç

```
üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: –∑–∞–ø—É—Å–∫ backend —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ API
```
