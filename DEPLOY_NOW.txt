ğŸš€ FINAL DEPLOYMENT COMMANDS - ALL FIXES READY
==============================================

Run these commands on your Ubuntu server:

# 1. Clone repository
cd /tmp
rm -rf psycholog_windexs_2
git clone https://github.com/RockInMyHead/psycholog_windexs_2.git

# 2. Backup current files
mkdir -p /var/www/psycholog.windexs.ru/backup/$(date +%Y%m%d_%H%M%S)
cp -r /var/www/psycholog.windexs.ru/* /var/www/psycholog.windexs.ru/backup/$(date +%Y%m%d_%H%M%S)/ 2>/dev/null || true

# 3. Extract deployment archive
cd /var/www/psycholog.windexs.ru
tar -xzf /tmp/psycholog_windexs_2/audio-fix-deploy.tar.gz

# 4. Verify deployment
ls -la assets/index-HuENCxTh.js
# Should show: index-HuENCxTh.js (~952KB)

# 5. Reload nginx
sudo systemctl reload nginx

# 6. Test
curl -s "https://psycholog.windexs.ru" | grep "index-.*\.js"
# Should return: index-HuENCxTh.js

# 7. Clean up
rm -rf /tmp/psycholog_windexs_2

EXPECTED RESULT:
================
âœ… No JavaScript errors
âœ… Audio recording works (blob sizes > 0 bytes)
âœ… Continuous recording on all platforms
âœ… iOS compatibility (3000ms chunks)
âœ… Android compatibility (1500ms chunks)
âœ… Mac/Windows compatibility (1000ms chunks)

LOGS YOU SHOULD SEE:
====================
[Timer] Recording state: isRecording=true, isPaused=false, chunks=X
[Timer] Got accumulated blob: 18421 bytes âœ…
[Timer] âœ… Sending blob (18421 bytes) for transcription

FIXES INCLUDED:
===============
âœ… Hook initialization order fixed
âœ… useEffect import added
âœ… isIOS initialization fixed
âœ… TTS logging spam eliminated
âœ… iOS white screen prevented
âœ… Chat error handling improved
âœ… Microphone permission handling improved
âœ… Continuous audio recording with natural chunk accumulation
âœ… Cross-platform optimized chunk durations and timer intervals
âœ… Enhanced logging for debugging recording state
âœ… Retry logic for empty blobs (500ms wait + retry)

TESTING:
========
1. Clear browser cache (Ctrl+Shift+R)
2. Visit: https://psycholog.windexs.ru/audio
3. Grant microphone access
4. Start audio call
5. Speak for 10-15 seconds
6. Check console: Should see blobs > 0 bytes
7. Verify transcriptions appear

Ready for production! ğŸ‰